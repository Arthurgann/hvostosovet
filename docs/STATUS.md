# STATUS — Хвостосовет (январь 2026)

Этот файл — **источник истины** о том, что в проекте уже реализовано и стабилизировано.
Используется для онбординга новых чатов / разработчиков и чтобы не предлагать повторно сделанные вещи.

---

## Реализовано и стабильно

### Pro профиль питомца
- Явное сохранение профиля через `POST /v1/pets/active/save`.
- PATCH / merge семантика: частичные обновления **не затирают** профиль.
- Сохранение **не вызывает LLM** и **не пишет в sessions**.
- Защита от двойного сохранения (`profile_saving`).
- Dirty-guard при выходе с несохранёнными изменениями:
  - варианты: **сохранить / не сохранять / остаться**.

### UX ⭐ «Мой питомец»
- Экран ⭐ «Мой питомец» с **summary профиля**.
- Краткий (short) / полный (full) вид профиля.
- Переключение short/full через `edit_message_text`
  с fallback на `reply()` при невозможности редактирования.
- Возврат из Pro post-меню (**«Вернуться к вопросу»**) всегда ведёт на:
  **⭐ «Мой питомец» (short)**.
- Dirty-discard (**«Не сохранять»**) также возвращает на ⭐ «Мой питомец» (short).

### Pro анкета питомца
- Базовые шаги: вид → имя → возраст → пол → порода/animal_kind → вес (опц.).
- Шаг имени:
  - поддерживает кнопку **«Пропустить»**;
  - поддерживает текстовый ввод «пропустить».
- Поддержка питомцев типа **`other`**:
  - используется поле `animal_kind`;
  - слово «Другое» в UI не показывается при наличии вида.
- Опциональные блоки:
  - **Особенности здоровья** (категории + текст);
  - **Прививки и профилактика** (vaccines / parasites);
  - **Важное о питомце** (free text).

### Remembered‑UX (Pro)
- Активный питомец хранится в backend (Supabase `pets`).
- При вопросе:
  - **Pro + minimal `{type}`** → профиль подтягивается из БД;
  - **Free** → профиль из БД **никогда** не подгружается.
- Контракт источника профиля:
  `request > db (Pro only) > none`.

### Архитектура
- Telegram‑бот = **тонкий клиент** (UX + state).
- Backend = **единый мозг** (логика, лимиты, LLM, память).
- Вопросы → `/v1/chat/ask`.
- Сохранение профиля → `/v1/pets/active/save`.
- Free / Pro определяется **только** через `users.plan` в БД.
- `FORCE_PRO` не используется в стабильном сценарии.

---

## Осознанно НЕ делаем сейчас
- Автосохранение анкеты без кнопки.
- Историю изменений профиля питомца.
- Web / PWA UI (подготовка есть, реализация позже).
- Платёжную систему и подписки.

---

## Как использовать файл
- В новом чате:  
  **«Контекст проекта зафиксирован в `docs/STATUS.md` — использовать как source of truth.»**
- Для деталей и истории изменений см. `CHANGELOG.md`.
