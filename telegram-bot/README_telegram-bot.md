# üêæ –•–≤–æ—Å—Ç–æ—Å–æ–≤–µ—Ç ‚Äî Telegram-–±–æ—Ç –¥–ª—è –ø–æ–º–æ—â–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞–º –ø–∏—Ç–æ–º—Ü–µ–≤

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**–•–≤–æ—Å—Ç–æ—Å–æ–≤–µ—Ç** ‚Äî Telegram-–±–æ—Ç, –ø–æ–º–æ–≥–∞—é—â–∏–π –≤–ª–∞–¥–µ–ª—å—Ü–∞–º –¥–æ–º–∞—à–Ω–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Ö–æ–¥—É, —Å–∏–º–ø—Ç–æ–º–∞–º, –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–µ –∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–º —Å–∏—Ç—É–∞—Ü–∏—è–º.

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** Telegram-–±–æ—Ç —è–≤–ª—è–µ—Ç—Å—è **—Ç–æ–Ω–∫–∏–º –∫–ª–∏–µ–Ω—Ç–æ–º**.  
–û–Ω **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç OpenAI –Ω–∞–ø—Ä—è–º—É—é**, **–ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–º–ø—Ç–æ–≤**, **–ù–ï –≤—ã–±–∏—Ä–∞–µ—Ç –º–æ–¥–µ–ª–∏** –∏ **–ù–ï —Ç—Ä–µ–±—É–µ—Ç `OPENAI_API_KEY`**.

–í—Å—è –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤, —Ä–µ–∂–∏–º—ã, –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ –∏ LLM –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ backend API.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
Telegram Bot ‚Üí Backend API ‚Üí LLM
```

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

---

telegram-bot/
‚îú‚îÄ‚îÄ main.py               # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py             # –∑–∞–≥—Ä—É–∑–∫–∞ env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ handlers/             # –±–∞–∑–æ–≤–∞—è Telegram UX-–ª–æ–≥–∏–∫–∞ (Free + —Ä–æ—É—Ç–∏–Ω–≥)
‚îÇ ‚îú‚îÄ‚îÄ start.py            # /start, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ ‚îú‚îÄ‚îÄ menu.py             # –∫–Ω–æ–ø–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ ‚îî‚îÄ‚îÄ question.py         # —Å–±–æ—Ä –≤–æ–ø—Ä–æ—Å–∞ –∏ –ø–æ–∫–∞–∑ –æ—Ç–≤–µ—Ç–∞ (—Ç–æ–Ω–∫–∏–π —Ä–æ—É—Ç–µ—Ä)
‚îú‚îÄ‚îÄ flows/                # —Å–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (Pro)
‚îÇ ‚îî‚îÄ‚îÄ pro_flow.py         # Pro-–ø—Ä–æ—Ñ–∏–ª—å: –∞–Ω–∫–µ—Ç–∞, post-–º–µ–Ω—é, remembered-UX, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ services/
‚îÇ ‚îú‚îÄ‚îÄ state.py            # –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ (flags, profile, steps)
‚îÇ ‚îî‚îÄ‚îÄ backend_client.py   # –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø —Ç–æ—á–∫–∞ HTTP ‚Üí backend
‚îî‚îÄ‚îÄ keyboards/            # inline / reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

```

---

### üì¶ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- Pyrogram
- tgcrypto
- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python (`urllib`)

‚ùå OpenAI SDK **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**  
‚ùå –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã LLM **–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**

---

## ü§ñ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç (—Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞)

1. `/start` ‚Üí –µ–¥–∏–Ω–æ–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:
   - üê∂ –°–æ–±–∞–∫–∞
   - üê± –ö–æ—à–∫–∞
   - üêæ –î—Ä—É–≥–æ–µ
   - ‚≠ê –ú–æ–π –ø–∏—Ç–æ–º–µ—Ü
   - ‚ÑπÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç / –¢–∞—Ä–∏—Ñ—ã
–Ω–∞ /start –Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ backend, –∑–∞–ø—Ä–æ—Å –∫ GET /v1/pets/active —Ç–æ–ª—å–∫–æ –ø–æ ‚Äú‚≠ê –ú–æ–π –ø–∏—Ç–æ–º–µ—Ü‚Äù.

2. –î–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ Free –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–∏—Ç–æ–º—Ü–∞:
   - üöë –°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å (`emergency`)
   - üçñ –£—Ö–æ–¥ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (`care`)
   - üíâ –ü—Ä–∏–≤–∏–≤–∫–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ (`vaccines`)
   - üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

3. –ë–æ—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–Ω–∫–µ—Ç–∞ + –≤–æ–ø—Ä–æ—Å)

4. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ backend API:
   ```
   POST /v1/chat/ask
   ```

5. Backend:
   - —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Å—Å–∏–µ–π –∏ TTL
   - –≤—ã–±–∏—Ä–∞–µ—Ç system-prompt –ø–æ —Ä–µ–∂–∏–º—É
   - —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
   - –≤—ã–∑—ã–≤–∞–µ—Ç LLM
   - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç

6. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é **–≥–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç**

---
‚≠ê Pro: –ø—Ä–æ—Ñ–∏–ª—å –ø–∏—Ç–æ–º—Ü–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

–î–ª—è Pro-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ—Å—Ç—É–ø–µ–Ω –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–∏—Ç–æ–º—Ü–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ backend (—Ç–∞–±–ª–∏—Ü–∞ pets.profile).

Remembered-UX

–ü–æ –∫–Ω–æ–ø–∫–µ ‚≠ê –ú–æ–π –ø–∏—Ç–æ–º–µ—Ü –±–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç backend:
GET /v1/pets/active?telegram_user_id=...
- –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞–π–¥–µ–Ω ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω:
   ‚ùì –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
   ‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
-–ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É.

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ post-–º–µ–Ω—é:

  ü©∫ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∑–¥–æ—Ä–æ–≤—å—è
  üíâ –ü—Ä–∏–≤–∏–≤–∫–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞
  üìå –í–∞–∂–Ω–æ–µ –æ –ø–∏—Ç–æ–º—Ü–µ

- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ state, –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ backend.

–Ø–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (Variant A)

- –ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–∫–∏.
- –í–æ –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è UX:
  ‚åõÔ∏è –°–æ—Ö—Ä–∞–Ω—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è‚Ä¶
 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑:
 POST /v1/chat/ask
 text="__save_profile__"
 
- –û—Ç–≤–µ—Ç LLM –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è;
- –ø—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ pets.profile;
- –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ profile_saving.

–í–æ–ø—Ä–æ—Å –≤ Pro-—Ä–µ–∂–∏–º–µ

- ‚ùì –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å ‚Üí –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ (—Å–∫–æ—Ä–∞—è / —É—Ö–æ–¥ / –ø—Ä–∏–≤–∏–≤–∫–∏);
- —à–∞–≥ basic_info –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è;
- –±–æ—Ç —Å—Ä–∞–∑—É –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å;
- backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–∏—Ç–æ–º—Ü–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ prompt.

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- Telegram-–±–æ—Ç = **UX + state**
- Backend = **–≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ LLM**
- –†–µ–∂–∏–º (`emergency | care | vaccines`) –≤–ª–∏—è–µ—Ç **—Ç–æ–ª—å–∫–æ** –Ω–∞ system-prompt –≤ backend
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ –µ–¥–∏–Ω—ã–π –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ backend
- Telegram / Web / PWA ‚Äî —Ä–∞–≤–Ω–æ–ø—Ä–∞–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã

---

## üîå Backend API

–ë–æ—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ backend —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π endpoint:

```
POST /v1/chat/ask
```

–ö–æ–Ω—Ç—Ä–∞–∫—Ç API –æ–ø–∏—Å–∞–Ω –≤:
```
docs/API.md
```
–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–æ –∑–∞–ø—É—Å–∫—É backend: —Å–º. `README_backend.md`.

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –î–ª—è Telegram-–±–æ—Ç–∞

```env
BACKEND_BASE_URL=http://127.0.0.1:8000
BOT_BACKEND_TOKEN=devtoken123
BOT_TOKEN=xxxxxxxxxxxxxxxx
```

### –í production (VPS)

```env
BACKEND_BASE_URL=https://api.tailadvice.ru
BOT_BACKEND_TOKEN=*** (—Ç–æ—Ç –∂–µ, —á—Ç–æ –≤ backend)
BOT_TOKEN=*** (Telegram Bot Token)
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Windows + VS Code)

```powershell
cd telegram-bot
.\.venv\Scripts\Activate.ps1
python -m pip install -r requirements.txt
python main.py
```

---

## üß™ Smoke-–ø—Ä–æ–≤–µ—Ä–∫–∞

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å backend
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Telegram-–±–æ—Ç
3. –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å ‚Üí –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç
4. –ó–∞–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–π –≤–æ–ø—Ä–æ—Å ‚Üí backend –ø–æ–ª—É—á–∞–µ—Ç –æ–±–∞ –∑–∞–ø—Ä–æ—Å–∞
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ—Ç **–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç OpenAI / gpt / prompts**

---

## üîú –ü–ª–∞–Ω—ã

- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Free / Pro (—á–µ—Ä–µ–∑ backend)
- [ ] –ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø (—Å–Ω—è—Ç–∏–µ –ª–∏–º–∏—Ç–æ–≤, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)
- [ ] –ü—Ä–æ—Ñ–∏–ª—å –ø–∏—Ç–æ–º—Ü–∞ (backend-first)
- [ ] Web / PWA –∫–ª–∏–µ–Ω—Ç (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è API)
- [ ] –§–æ—Ç–æ –∏ –∞—É–¥–∏–æ (—á–µ—Ä–µ–∑ backend)

---

## üë§ –ê–≤—Ç–æ—Ä

- Telegram: @TailAdvice_Bot  
- –°—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: Windows 11 / Visual Studio Code  

---

–§–∞–π–ª –æ—Ç—Ä–∞–∂–∞–µ—Ç **—Ç–µ–∫—É—â–µ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞**  
–∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ reference –¥–ª—è –Ω–æ–≤—ã—Ö —á–∞—Ç–æ–≤ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
